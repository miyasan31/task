<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>{{ user?.userName }}</ion-title>
  </ion-toolbar>

  <ion-toolbar>
    <ion-segment
      [(ngModel)]="scene"
      class="component-segments"
      (ionChange)="onSegmentChanged($event)"
    >
      <ion-segment-button value="profile">
        <ion-label>プロフィール</ion-label>
      </ion-segment-button>
      <ion-segment-button value="task">
        <ion-label> 完了タスク </ion-label>
      </ion-segment-button>
      <ion-segment-button value="like">
        <ion-label> いいね </ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="component-profile" [hidden]="scene !== 'profile'">
    <div class="user-info">
      <img
        class="user-avatar"
        src="{{ user?.avatar }}"
        alt="{{ user?.userName }}のユーザーアバター"
      />
      <div class="user-status">
        <div class="user-status-item">
          <p class="count-text">20</p>
          <p class="count-label">連続コミット</p>
        </div>
        <div class="user-status-item">
          <p class="count-text">{{ isDoneTaskCount }}</p>
          <p class="count-label">タスク完了</p>
        </div>
        <div class="user-status-item">
          <p class="count-text">{{ likeCount }}</p>
          <p class="count-label">貰ったいいね</p>
        </div>
      </div>
    </div>
    <p class="user-name">{{ user?.userName }}</p>
    <p class="profile-body">{{ user?.profile || 'プロフィール文が未入力です。' }}</p>
    <app-calendar-heatmap></app-calendar-heatmap>
    <ion-button (click)="onSignOut()">サインアウト</ion-button>
  </div>

  <div [hidden]="scene !== 'task'">
    <ng-template #loading>
      <app-task-card-skeleton></app-task-card-skeleton>
      <app-task-card-skeleton></app-task-card-skeleton>
      <app-task-card-skeleton></app-task-card-skeleton>
    </ng-template>

    <ng-container *ngIf="taskList | async; else loading">
      <app-task-detail-card
        *ngFor="let task of taskList | async; trackBy: trackByFn"
        [user]="user"
        [task]="task"
      ></app-task-detail-card>
    </ng-container>

    <!-- <div *ngIf="!(taskList | async)?.length">
      <p class="empty-message">完了タスクがまだありません</p>
    </div> -->
  </div>

  <div [hidden]="scene !== 'like'">
    <ng-template #loading>
      <app-task-card-skeleton></app-task-card-skeleton>
      <app-task-card-skeleton></app-task-card-skeleton>
      <app-task-card-skeleton></app-task-card-skeleton>
    </ng-template>

    <ng-container *ngIf="likeList | async; else loading">
      <app-task-detail-card
        *ngFor="let like of likeList | async; trackBy: trackByFn"
        [user]="like.user"
        [task]="{ like: like.like, task: like.task }"
      ></app-task-detail-card>
    </ng-container>

    <!-- <div *ngIf="!(likeList | async)?.length">
      <p class="empty-message">いいねがまだありません</p>
    </div> -->
  </div>
</ion-content>
