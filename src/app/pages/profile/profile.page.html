<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button (click)="navigateBack()" text=""></ion-back-button>
    </ion-buttons>

    <ion-title>{{ user?.userName }}</ion-title>
  </ion-toolbar>

  <ion-toolbar>
    <ion-segment
      [(ngModel)]="scene"
      class="component-segments"
      (ionChange)="onSegmentChanged($event)"
    >
      <ion-segment-button value="profile">
        <ion-label>プロフィール</ion-label>
      </ion-segment-button>
      <ion-segment-button value="task">
        <ion-label> 完了タスク </ion-label>
      </ion-segment-button>
      <ion-segment-button value="like">
        <ion-label> いいね </ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="profile-scene" [hidden]="scene !== 'profile'">
    <ion-refresher
      slot="fixed"
      pullFactor="0.5"
      pullMin="100"
      pullMax="200"
      (ionRefresh)="onProfileRefresh($event)"
    >
      <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <app-profile-skeleton *ngIf="!user"></app-profile-skeleton>

    <ng-container *ngIf="user">
      <app-profile
        [user]="user"
        [isDoneTaskCount]="isDoneTaskCount"
        [likeCount]="likeCount"
      ></app-profile>
      <app-calendar-heatmap></app-calendar-heatmap>
      <ion-button (click)="onSignOut()">サインアウト</ion-button>
    </ng-container>
  </div>

  <div [hidden]="scene !== 'task'">
    <ng-template #loading>
      <app-task-card-skeleton></app-task-card-skeleton>
      <app-task-card-skeleton></app-task-card-skeleton>
      <app-task-card-skeleton></app-task-card-skeleton>
    </ng-template>

    <ng-container *ngIf="taskList | async; else loading">
      <app-task-detail-card
        *ngFor="let task of taskList | async; trackBy: trackByFn"
        [user]="user"
        [task]="task"
        profilePath=""
        tagPath="profile/{{ user.id }}/{{ task.tag.id }}"
      ></app-task-detail-card>
    </ng-container>
  </div>

  <div [hidden]="scene !== 'like'">
    <ng-template #loading>
      <app-task-card-skeleton></app-task-card-skeleton>
      <app-task-card-skeleton></app-task-card-skeleton>
      <app-task-card-skeleton></app-task-card-skeleton>
    </ng-template>

    <ng-container *ngIf="likeList | async; else loading">
      <app-task-detail-card
        *ngFor="let like of likeList | async; trackBy: trackByFn"
        [user]="like.user"
        [task]="{ like: like.like, task: like.task, tag: like.tag }"
        profilePath="profile/{{ like.user.id }}"
        tagPath="profile/{{ like.user.id }}/{{ like.tag.id }}"
      ></app-task-detail-card>
    </ng-container>
  </div>
</ion-content>
